<html>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <head>
  <style>
  :root {
    --primary: #2b13e3;
    --secondary: #1a1a1a;
    --text: #333;
    --text-secondary: #657786;
    --bg: #f5f5f5;
  }
  
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    padding: 20px;
    background: var(--bg);
    color: var(--text);
  }
  
  .dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  }
  
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .header nav {
    margin-right: auto;
    margin-left: 20px;
  }
  
  .login-section {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .balances {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .balance-card {
    background: linear-gradient(135deg, var(--primary), #ff4757);
    color: white;
    padding: 20px;
    border-radius: 10px;
    transition: transform 0.2s;
  }
  
  .balance-card:hover {
    transform: translateY(-5px);
  }
  
  .actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
  }
  
  .action-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #ddd;
  }
  
  .input-icon {
    position: relative;
    margin-bottom: 10px;
  }
  
  .input-icon i {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
    margin-right: 10px;
  }
  
  .input-icon input {
    padding-left: 40px;
  }
  
  input, button {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
  }
  
  button {
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  button:hover {
    transform: scale(1.05);
    background: #7847ff;
  }
  
  .message {
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
  }
  
  .success {
    background: #4cd137;
    color: white;
  }
  
  .error {
    background: #e84118;
    color: white;
  }
  
  .delegation-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
  }
  
  .delegation-table th,
  .delegation-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    background-color: var(--bg);
    color: var(--text);
  }
  
  .delegation-table th {
    background-color: #f8f9fa;
    font-weight: 600;
  }
  
  .delegation-table tbody tr:nth-child(even) {
    background-color: #f8f9fa;
  }
  
  .dropdown {
    position: relative;
    display: inline-block;
  }
  
  .dropbtn {
    background-color: var(--primary);
    color: white;
    padding: 10px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
  }
  
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    right: 0;
  }
  
  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }
  
  .dropdown-content a:hover {
    background-color: #f1f1f1;
  }
  
  .dropdown:hover .dropdown-content {
    display: block;
  }
  
  .dark-theme {
    --primary: #1DA1F2;
    --secondary: #657786;
    --text: #ffffff; 
    --bg: #15202b;
    --card-bg: #192734;
  }
  
  .dark-theme .dashboard {
    background: var(--bg);
    color: var(--text);
  }
  
  .dark-theme .login-section,
  .dark-theme .action-card,
  .dark-theme .delegation-table th {
    background: var(--card-bg);
  }
  
  .dark-theme input,
  .dark-theme button {
    background: var(--card-bg);
    color: var(--text);
    border-color: var(--secondary);
  }
  
  .dark-theme button:hover {
    background: var(--primary);
  }
  
  .dark-theme nav a {
    color: var(--text);
  }
  
  .dark-theme .dropbtn {
    background-color: var(--card-bg);
    color: var(--text);
  }
  
  .dark-theme .dropdown-content {
    background-color: var(--bg);
  }
  
  .dark-theme .dropdown-content a {
    color: var(--text);
  }
  
  .dark-theme .dropdown-content a:hover {
    background-color: var(--card-bg);
  }
  
  #activityList {
    margin-top: 20px;
  }
  
  #activityList .activity-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #eee;
  }
  
  #activityList .activity-icon {
    font-size: 20px;
    margin-right: 10px;
  }
  
  #activityList .activity-details {
    flex-grow: 1;
  }
  
  #activityList .activity-type {
    font-weight: bold;
  }
  
  #activityList .activity-timestamp {
    color: #666;
    font-size: 12px;
  }
  
  .theme-toggle {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0;
    margin-left: 10px;
  }
  
  .theme-toggle:hover {
    color: var(--text);
  }
  
  .theme-toggle i {
    font-size: 24px;
  }
  
  .activity-link {
    color: var(--primary);
    text-decoration: none;
    font-size: 12px;
    margin-top: 5px;
    display: inline-block;
  }
  
  .activity-link:hover {
    text-decoration: underline;
  }
  
  @media screen and (max-width: 600px) {
    body {
      padding: 10px;
    }
  
    .dashboard {
      padding: 10px;
    }
  
    .header {
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 20px;
    }
  
    .header h1 {
      margin-bottom: 10px;
    }
  
    .header nav {
      margin-left: 0;
      margin-bottom: 10px;
    }
  
    .balances {
      grid-template-columns: 1fr;
    }
  
    .actions {
      grid-template-columns: 1fr;
    }
  
    .input-icon input {
      padding: 10px 10px 10px 40px;
    }
  
    .delegation-table {
      font-size: 14px;
    }
  
    .delegation-table th,
    .delegation-table td {
      padding: 8px;
    }
  
    #activityList .activity-item {
      flex-direction: column;
      align-items: flex-start;
    }
  
    #activityList .activity-icon {
      margin-bottom: 5px;
    }
  }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/steem@0.7.11/dist/steem.min.js"></script>
  </head>
  <body>
  
  <div class="dashboard">
    <div class="header">
      <h1>Steem Wallet Dashboard</h1>
      <nav style="display: none;">
        <div class="dropdown">
          <button class="dropbtn">Menu</button>
          <div class="dropdown-content">
            <a href="#" id="dashboardLink">Dashboard</a>
            <a href="#" id="historyLink">Account History</a>
          </div>
        </div>
      </nav>  
      <div>
        <div id="userInfo"></div>
        <button id="themeToggle" class="theme-toggle">
          <i class="fas fa-sun"></i>
        </button>
      </div>
    </div>
  
    <div class="login-section" id="loginSection">
      <h2>Login with Hive Keychain</h2>
      <div class="input-icon">
        <i class="fas fa-user"></i>
        <input type="text" id="accountName" placeholder="Enter your Steem username" style="text-transform: lowercase;">
      </div>
      <button id="loginButton">Login</button>
      <div id="loginMessage" class="message"></div>
      <div id="keychainMessage" class="message" style="display: none;">
        Steem Keychain extension is not installed. <a href="https://chromewebstore.google.com/detail/steemkeychain/jhgnbkkipaallpehbohjmkbjofjdmeid" target="_blank">Click here to install it</a>.
      </div>
    </div>
  
    <div id="dashboardContent" style="display:none">
      <div class="balances">
        <div class="balance-card">
          <h3>STEEM Balance</h3>
          <div id="hiveBalance">Loading...</div>
        </div>
        <div class="balance-card">
          <h3>STEEM POWER</h3>
          <div id="hivePower">Loading...</div>
        </div>
        <div class="balance-card">
          <h3>SBD Balance</h3>
          <div id="hbdBalance">Loading...</div>
        </div>
      </div>
  
      <div class="actions">
        <div class="action-card">
          <h3>Transfer STEEM</h3>
          <form id="transferForm">
            <div class="input-icon">
              <i class="fas fa-user"></i>
              <input type="text" id="recipient" placeholder="Recipient">
            </div>
            <div class="input-icon">
              <i class="fas fa-coins"></i>
              <input type="number" id="amount" placeholder="Amount" step="0.001">
            </div>
            <div class="input-icon">
              <i class="fas fa-envelope"></i>
              <input type="text" id="memo" placeholder="Memo (optional)">
            </div>
            <button type="submit">Send Steem</button>
          </form>
          <div id="transferMessage" class="message"></div>
        </div>
  
        <div class="action-card">
          <h3>Power Up/Down Steem</h3>
          <form id="powerForm">
            <div class="input-icon">
              <i class="fas fa-coins"></i>
              <input type="number" id="powerAmount" placeholder="Amount" step="0.001">
            </div>
            <button type="submit" id="powerUpButton">Power Up</button>
            <!-- <button type="submit" id="powerDownButton">Power Down</button> -->
          </form>
          <div id="powerUpMessage" class="message"></div>
          <div id="powerDownMessage" class="message"></div>
        </div>
  
        <div class="action-card">  
          <h3>Delegate STEEM POWER</h3>
          <form id="delegateForm">
            <div class="input-icon">
              <i class="fas fa-user"></i>
              <input type="text" id="delegatee" placeholder="Delegatee username">
            </div>
            <div class="input-icon">
              <i class="fas fa-coins"></i>  
              <input type="number" id="delegateAmount" placeholder="HP Amount" step="0.001">
            </div>
            <button type="submit">Delegate</button>
          </form>
          <div id="delegateMessage" class="message"></div>
        </div>
      </div>
  
      <h2>Delegations</h2>
      <table id="delegationTable" class="delegation-table">
        <thead>
          <tr>
            <th>Delegatee</th>
            <th>Amount (SP)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  
    <div id="historyContent" style="display:none">
      <h2>Account History</h2>
      <div id="activityList"></div>
    </div>
  </div>
  
  <script>let currentUser = null;

steem.api.setOptions({
  url: 'https://api.justyy.com'
});

function showMessage(message, isSuccess, elementId = 'loginMessage') {
  const messageElement = document.getElementById(elementId);
  messageElement.textContent = message;
  messageElement.className = 'message ' + (isSuccess ? 'success' : 'error');
  messageElement.style.display = 'block';
}
function loginSuccess(username) {
  currentUser = username;
  document.getElementById('loginSection').style.display = 'none';
  document.getElementById('dashboardContent').style.display = 'block';
  document.querySelector('nav').style.display = 'block';
  document.getElementById('userInfo').textContent = `Welcome, @${username}!`;
  updateBalances();
  updateDelegations();
  document.getElementById('dashboardLink').addEventListener('click', function (e) {
    e.preventDefault();
    document.getElementById('dashboardContent').style.display = 'block';
    document.getElementById('historyContent').style.display = 'none';
  });
  document.getElementById('historyLink').addEventListener('click', function (e) {
    e.preventDefault();
    document.getElementById('dashboardContent').style.display = 'none';
    document.getElementById('historyContent').style.display = 'block';
    loadAccountHistory(username);
  });
}
function loadAccountHistory(username) {
  steem.api.getAccountHistory(username, -1, 20, function (err, result) {
    if (err) {
      console.error('Error fetching account history:', err);
      return;
    }
    const activityList = document.getElementById('activityList');
    activityList.innerHTML = '';
    result.forEach(([id, transaction]) => {
      const op = transaction.op;
      const type = op[0];
      const data = op[1];
      let activityHtml = `
            <div class="activity-item">
              <div class="activity-icon">
      `;
      switch (type) {
        case 'transfer':
          activityHtml += `<i class="fas fa-exchange-alt" style="color: #e74c3c;"></i>`;
          break;
        case 'vote':
          activityHtml += `<i class="fas fa-thumbs-up" style="color: #2ecc71;"></i>`;
          break;
        case 'comment':
          activityHtml += `<i class="fas fa-comment" style="color: #9b59b6;"></i>`;
          break;
        default:
          activityHtml += `<i class="fas fa-circle" style="color: #bdc3c7;"></i>`;
      }
      activityHtml += `
              </div>
              <div class="activity-details">
                <div class="activity-type">${type}</div>
                <div class="activity-timestamp">${new Date(transaction.timestamp).toLocaleString()}</div>
                <a href="https://steemblockexplorer.com/tx/${transaction.trx_id}" target="_blank" class="activity-link">View on Steem Block Explorer</a>
              </div>
            </div>
          `;
      activityList.innerHTML += activityHtml;
    });
  });
}
async function updateBalances() {
  try {
    const account = await new Promise((resolve, reject) => {
      steem.api.getAccounts([currentUser], (err, result) => {
        if (err) reject(err);else resolve(result[0]);
      });
    });
    const hiveBalance = parseFloat(account.balance).toFixed(3);
    const hbdBalance = parseFloat(account.sbd_balance).toFixed(3);
    const vestingShares = parseFloat(account.vesting_shares);
    const delegatedVestingShares = parseFloat(account.delegated_vesting_shares);
    const receivedVestingShares = parseFloat(account.received_vesting_shares);
    const hivePower = await vestsToHive(vestingShares - delegatedVestingShares + receivedVestingShares);
    document.getElementById('hiveBalance').textContent = `${hiveBalance} STEEM`;
    document.getElementById('hivePower').textContent = `${hivePower.toFixed(3)} SP`;
    document.getElementById('hbdBalance').textContent = `${hbdBalance} SBD`;
  } catch (error) {
    console.error('Error updating balances:', error);
  }
}
async function updateDelegations() {
  try {
    const result = await new Promise((resolve, reject) => {
      steem.api.getVestingDelegations(currentUser, null, 100, (err, result) => {
        if (err) reject(err);else resolve(result);
      });
    });
    const delegationTableBody = document.querySelector('#delegationTable tbody');
    delegationTableBody.innerHTML = '';
    for (const delegation of result) {
      const row = document.createElement('tr');
      const delegateeCell = document.createElement('td');
      const amountCell = document.createElement('td');
      delegateeCell.textContent = delegation.delegatee;
      amountCell.textContent = `${(await vestsToHive(delegation.vesting_shares)).toFixed(3)} SP`;
      row.appendChild(delegateeCell);
      row.appendChild(amountCell);
      delegationTableBody.appendChild(row);
    }
  } catch (error) {
    console.error('Error updating delegations:', error);
  }
}
document.getElementById('loginButton').addEventListener('click', function () {
  const accountName = document.getElementById('accountName').value.toLowerCase();
  if (!accountName) {
    showMessage('Please enter your username', false);
    return;
  }
  if (typeof steem_keychain === 'undefined') {
    document.getElementById('keychainMessage').style.display = 'block';
    return;
  }
  steem_keychain.requestSignBuffer(accountName, 'Login to Hive Dashboard', 'Posting', function (response) {
    if (response.success) {
      loginSuccess(accountName);
    } else {
      showMessage('Login failed: ' + response.message, false);
    }
  });
});
document.getElementById('transferForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const recipient = document.getElementById('recipient').value;
  const amount = parseFloat(document.getElementById('amount').value).toFixed(3);
  const memo = document.getElementById('memo').value;
  if (!recipient || !amount) {
    showMessage('Please fill in all required fields', false, 'transferMessage');
    return;
  }
  steem_keychain.requestTransfer(currentUser, recipient, amount, memo, 'STEEM', function (response) {
    if (response.success) {
      showMessage('Transfer completed successfully!', true, 'transferMessage');
      document.getElementById('transferForm').reset();
      updateBalances();
    } else {
      showMessage('Transfer failed: ' + response.message, false, 'transferMessage');
    }
  });
  updateDelegations();
});

// Power Up/Down Form
document.getElementById('powerForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const amount = parseFloat(document.getElementById('powerAmount').value).toFixed(3);
  if (!amount) {
    showMessage('Please enter an amount', false, 'powerUpMessage');
    return;
  }

  // Check which button was clicked
  const isPowerUp = e.submitter.id === 'powerUpButton';

  if (isPowerUp) {
    // Power Up
    steem_keychain.requestPowerUp(currentUser , currentUser , amount, function (response) {
      if (response.success) {
        showMessage('Power up completed successfully!', true, 'powerUpMessage');
        document.getElementById('powerForm').reset();
        updateBalances();
        updateDelegations();
      } else {
        showMessage('Power up failed: ' + response.message, false, 'powerUpMessage');
      }
    });
  } else {
    // Power Down
    steem_keychain.requestPowerDown(currentUser , currentUser , amount, function (response) {
      if (response.success) {
        showMessage('Power down completed successfully!', true, 'powerDownMessage');
        document.getElementById('powerForm').reset();
        updateBalances();
        updateDelegations();
      } else {
        showMessage('Power down failed: ' + response.message, false, 'powerDownMessage');
      }
    });
  }
});

document.getElementById('delegateForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const delegatee = document.getElementById('delegatee').value;
  const amount = parseFloat(document.getElementById('delegateAmount').value).toFixed(3);
  if (!delegatee || !amount) {
    showMessage('Please fill in all required fields', false, 'delegateMessage');
    return;
  }
  steem_keychain.requestDelegation(currentUser, delegatee, amount, 'SP', function (response) {
    if (response.success) {
      showMessage('Delegation completed successfully!', true, 'delegateMessage');
      document.getElementById('delegateForm').reset();
      updateBalances();
    } else {
      showMessage('Delegation failed: ' + response.message, false, 'delegateMessage');
    }
  });
  updateDelegations();
});
async function vestsToHive(vests) {
  return new Promise((resolve, reject) => {
    steem.api.getDynamicGlobalProperties(function (err, result) {
      if (err) {
        reject(err);
        return;
      }
      const totalVests = parseFloat(result.total_vesting_shares.split(' ')[0]);
      const totalHive = parseFloat(result.total_vesting_fund_steem.split(' ')[0]);
      const hivePerVest = totalHive / totalVests;
      const hive = parseFloat(vests) * hivePerVest;
      resolve(hive);
    });
  });
}
async function hiveToVests(steem) {
  return new Promise((resolve, reject) => {
    steem.api.getDynamicGlobalProperties(function (err, result) {
      if (err) {
        reject(err);
        return;
      }
      const totalVests = parseFloat(result.total_vesting_shares.split(' ')[0]);
      const totalHive = parseFloat(result.total_vesting_fund_steem.split(' ')[0]);
      const vestsPerHive = totalVests / totalHive;
      const vests = parseFloat(steem) * vestsPerHive;
      resolve(vests.toFixed(6));
    });
  });
}
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
themeToggle.addEventListener('click', function () {
  body.classList.toggle('dark-theme');
  if (body.classList.contains('dark-theme')) {
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
});</script>
  
  </body>
  </html>